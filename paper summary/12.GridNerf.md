# 要解决的问题
## 一、现有方法的问题
### 1.基于Nerf的方法
基于NeRF的表示通过将点坐标的位置编码(PE)传递到一个8层的MLP来获得体密度和颜色，这种模型是高度紧凑的，因为整个场景内容以PE作为输入被编码在MLP权重中，它们面临着受模型容量限制而无法应用于大规模场景中的困难。对于大规模场景，最近的方法（Block-nerf、Mega-nerf、Switch-Nerf）提出在地理上划分场景，并采用多个子神经网络分别对每个区域建模，导致随着场景的扩展，子神经网络的数量线性增加，从而训练成本也线性增加。
### 2.基于特征网格的方法
基于特征网格的方法将场景编码为特征网格，可以直观地将其视为网格分辨率与实际3D空间相匹配的3D体素网格，每个体素在顶点处存储一个特征向量，然后可以进行插值以提取查询点坐标处的特征值，并通过一个小网络转换为体密度和颜色。这种方法计算效率虽然高，可以提高网格分辨率以扩展到大型场景，但特征网格往往约束较少，并且经常达到次优的解决方案，在渲染中产生噪声伪像和模糊，特别是在具有复杂几何和纹理的区域中。
## 二、本文提出的解决方法
综合基于Nerf的方法和基于特征网格的方法，提出一个双分支的模型架构(Grid分支和Nerf分支)，集成了基于特征网格和基于Nerf的方法(本文认为两种方法是互补的)。在预训练阶段通过Grid分支粗略的预测场景的几何形状和外观，并生成一组信息丰富的多分辨率密度 / 外观特征平面，这些粗略的特征之后用在Nerf分支，指导Nerf采样点让他更集中在场景表面，且给Nerf的位置编码提供额外的关于该位置的场景形状和外观特征，且这些多分辨率密度 / 外观特征平面可通过其与NeRF分支的联合学习而获得进一步细化。

# 具体实现
本文可以分为两个阶段，预训练阶段和联合学习阶段，其中预训练阶段只有Grid分支，联合学习阶段有Grid和Nerf分支。  
![pipline](https://github.com/gjgjgjfff/Nerf_Learn/blob/main/img/GridNerf/pipline.png)  
本文的核心是一个新的双分支结构，即Grid分支和 NeRF 分支。1) 首先在预训练阶段捕捉特征平面的金字塔场景，并通过浅 MLP 渲染器（Grid分支）对射线点进行粗略的采样，并预测它们的辐射值，由体渲染的像素颜色上的 MSE 损失监督。预训练阶段生成一组信息丰富的多分辨率密度 / 外观特征平面。2) 接下来，进入联合学习阶段，并进行更精细的抽样，使用学习的粗略特征来指导 NeRF 分支采样，以集中在场景表面，通过在多分辨率特征平面上的双线性插值法，推导出采样点的网格特征，然后将这些特征与位置编码连接，并输入 NeRF 分支以预测体积密度和颜色。请注意，在联合训练过程中，Grid分支和Nerf分支的输出仍然使用体渲染的像素颜色上的 MSE 损失监督。  
> 1.为什么要进行预训练呢？因为随机初始化的多分辨率特征平面很难提供有信息的场景内容。  
> 2.为什么预训练阶段只有Grid分支？因为预训练阶段比包括NeRF分支的阶段(联合学习阶段)快得多，使得仅用Grid分支可靠地构建粗糙几何结构更有效。  
> 3.这里预训练阶段生成的多分辨率特征平面可通过在联合学习阶段与NeRF分支的联合学习而获得进一步细化，不是预训练结束后就被冻结而一直不变的，具体看下方第4.。  
### 1.预训练阶段
预训练阶段生成一组信息丰富的多分辨率密度 / 外观特征平面，即上图中的Density和RGB Fields(具体怎么生成的没看懂)，然后通过在位置 $X$ 处从两个多分辨率特征平面上提取特征值，再加上方向 $d$ 的位置编码，送入Grid分支生成 $\sigma$  和 $c$ 。
### 2.Grid分支
![Grid-branch](https://github.com/gjgjgjfff/Nerf_Learn/blob/main/img/GridNerf/Grid-branch.jpg)  
### 3.Nerf分支
然后通过在位置 $X$ 处从两个多分辨率特征平面上提取特征值，再加上位置坐标 $X$ 和方向 $d$ 的位置编码，送入Nerf分支生成 $\sigma '$  和 $c'$ 。
![Nerf-branch](https://github.com/gjgjgjfff/Nerf_Learn/blob/main/img/GridNerf/Nerf-branch.png)  
### 4.通过Nerf分支调整多分辨率特征平面
![refine](https://github.com/gjgjgjfff/Nerf_Learn/blob/main/img/GridNerf/refine.png)  
